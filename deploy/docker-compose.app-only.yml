# FreeHire 仅应用部署配置（使用外部数据库和Redis）
#
# 使用方式:
#   1. 修改 .env 中的数据库和 Redis 连接信息
#   2. docker compose -f docker-compose.app-only.yml up -d

services:
  # 后端服务
  backend:
    image: freehire/freehire-server:latest
    container_name: freehire-backend
    restart: always
    environment:
      SPRING_PROFILES_ACTIVE: prod
      # 数据库配置（连接外部 PostgreSQL）
      DB_HOST: ${DB_HOST:-localhost}
      DB_PORT: ${DB_PORT:-5432}
      DB_NAME: ${DB_NAME:-freehire}
      DB_USER: ${DB_USER:-postgres}
      DB_PASSWORD: ${DB_PASSWORD:-postgres}
      # Redis配置（连接外部 Redis）
      REDIS_HOST: ${REDIS_HOST:-localhost}
      REDIS_PORT: ${REDIS_PORT:-6379}
      REDIS_PASSWORD: ${REDIS_PASSWORD:-}
      TZ: Asia/Shanghai
    ports:
      - "8080:8080"
    volumes:
      - upload_data:/data/freehire/uploads
      - logs_data:/var/log/freehire
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "wget", "-q", "-O", "-", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # 前端服务
  frontend:
    image: freehire/freehire-web:latest
    container_name: freehire-frontend
    restart: always
    ports:
      - "80:80"
    depends_on:
      - backend

volumes:
  upload_data:
  logs_data:

